---
title: "QTL + GWAS"
author: "Jinliang Yang"
date: "May 3, 2024"
output:
  xaringan::moon_reader:
    css: ["default", "../../asset/unl-150.css"]
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
```


---
# QTL or Linkage Mapping

Linkage mapping uses statistical techniques to localize chromosomal
regions that might contain genes contributing to phenotypic variation in a complex trait of interest.


#### Steps for QTL mapping include:

  - 1) Create a segregating population
    - __mating design__
  
  - 2) Genotype individuals within this population with molecular markers
    - __genotyping by sequencing__
  
  - 3) Phenotype the individuals
    - __field experimental design__
  
  - 4) Apply statistical models to associate the markers to the phenotypic variation
    - __single-marker analysis__ or __interval mapping__


---
# Recombinant inbred lines (RILs)

.pull-left[
<div align="center">
<img src="ril.jpg" height=400>
</div>
> Mauricio et al., 2001
]

--

#### a. Select the parental lines with extreme phenotypes

  - The density of hairs that occur on a plant leaf

--

#### b. Selfing an F1 to form a population of F2 individuals 

--

#### c. Each F2 is selfed for six additional generations

  - Forming a population of recombinant inbred lines (RILs)

  - Each RIL is homozygous for a section of a parental chromosome

---
# Simulating a QTL mapping experiment

#### Simulate a F2 population with 250 individuals

```{r, out.width='50%', fig.align='center', echo=TRUE}
library(qtl)
set.seed(12347)
# Five autosomes of cM length 50, 75, 100, 125, 60
L <- c(50, 75, 100, 125, 60)
map <- sim.map(L, n.mar=L/5+1, eq.spacing=FALSE, include.x=FALSE)
# simulate founder genotypes
pg <- simFounderSnps(map, "4")
pop <- sim.cross(map, type="f2", n.ind=250, model = rbind(c(1,45,1,1),c(5,20,0.5,-0.5)))
plot.map(pop)
```

---

# Simulating a QTL mapping experiment

#### Checking phenotypic distribution

```{r, out.width='50%', fig.align='center', echo=TRUE}
hist(pop$pheno$phenotype, main="simulated phenotype", 
     breaks=50, xlab="Phenotype", col="#cdb79e")
```


---
# Single-marker analysis

```{r, out.width='50%', fig.align='center', echo=TRUE}
# single-QTL scan by marker regression with the simulated data
out.mr <- scanone(pop, method="mr")

# plot of marker regression results for chr 4 and 12
plot(out.mr, chr=c(1,2,3,4,5), ylab="LOD Score")
```


---
# Haley-knott Regression

This is a version of interval mapping which is a very good approximation to interval mapping via maximum likelihood.


```{r, out.width='50%', fig.align='center', echo=TRUE, warning=FALSE}
# single-QTL scan using Haley-knott Regression approach
out.hk <- scanone(pop, method="hk")

# plot of marker regression results for chr 4 and 12
plot(out.hk, chr=c(1,2,3,4,5), ylab="LOD score")
```

---
# Plot QTL effect

```{r, out.width='40%', fig.align='center', echo=TRUE, warning=FALSE}
# summary of out.mr
summary(out.mr, threshold=3)

effectplot(pop, mname1="D1M10", main="Chr1")
```

---
# Plot QTL effect

```{r, out.width='40%', fig.align='center', echo=TRUE, warning=FALSE}
# summary of out.mr
summary(out.mr, threshold=3)

effectplot(pop, mname1="D5M6", main="Chr5")
```

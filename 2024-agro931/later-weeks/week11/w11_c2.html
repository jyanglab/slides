<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Heritability: precision of estimation</title>
    <meta charset="utf-8" />
    <meta name="author" content="Jinliang Yang" />
    <meta name="date" content="2022-11-02" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link rel="stylesheet" href="../../asset/unl-150.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Heritability: precision of estimation
### Jinliang Yang
### Nov.Â 2, 2022

---





# Variance componenets in a sib design

| Source        |    df     |  Sums of Squares      | MS      | E(MS) |
| :------:      | :-------: | :--------------------:|:------: | :---------------: |
| Sires         | s-1       |  `\(dn\sum\limits_{i=1}^s(\bar{p}_i - \bar{p})^2\)` | `\(MS_s\)` | `\(= \sigma_w^2 + n\sigma_d^2 + dn\sigma_s^2\)`   |
| Dams (Sires)  | s(d-1)    |  `\(n\sum\limits_{i=1}^s\sum\limits_{j=1}^d(\bar{p}_{ij} - \bar{p}_i)^2\)` | `\(MS_d\)`  | `\(= \sigma_w^2 + n\sigma_d^2\)` | 
| Sibs (Dams)   | sd(n-1)   |  `\(\sum\limits_{i=1}^s\sum\limits_{j=1}^d\sum\limits_{k=1}^n(p_{ijk} - \bar{p}_{ij})^2\)`  | `\(MS_w\)`       | `\(= \sigma_w^2\)` |

--

Under the assumption that individuals are random members of the same population:

#### Phenotypic variance

Phenotypic variance is the sum ( `\(\sigma_T^2\)` ) of the three observational components:

`\begin{align*}
 V_P &amp; = \sigma_T^2 \\
&amp; = \sigma^2_s + \sigma^2_d + \sigma^2_w\\
&amp; = \sigma^2_A + \sigma^2_D + \sigma^2_E\\
\end{align*}`


---
# Interpretation of variance components

&lt;div align="center"&gt;
&lt;img src="sdkids.png" height=180&gt;
&lt;/div&gt;


### Among-sire component `\(\sigma_s^2\)`

This is the __variance between the means of half-sib families__ 

--

- A key concept in the __analysis of variance (ANOVA)__ is that:
  - The variance between groups is equal to the covariance within groups.
- It therefore estimates the phenotypic __covariance of half sibs__.

--

`\begin{align*}
&amp; \sigma_s^2 = Cov(HS) = \frac{1}{4}\sigma_A^2 \\
\end{align*}`



---
# Interpretation of variance components

### Within-progeny component `\(\sigma_w^2\)`
- Another key concept in the __analysis of variance (ANOVA)__ is:

  - The total variance = between-group variance + within-group variance

--

- It follows that the  __within-group variance = total variance - covariance of members of the groups__.

--

Within-dams are full-sibs, therefore,

`\begin{align*}
\sigma_w^2 &amp;  = V_P - Cov(FS) \\
&amp; = \sigma^2_A + \sigma^2_D + \sigma^2_E - (\frac{1}{2}\sigma^2_A + \frac{1}{4}\sigma^2_D) \\
&amp; = \frac{1}{2}\sigma^2_A + \frac{3}{4}\sigma^2_D + \sigma^2_E
\end{align*}`


---
# Interpretation of variance components

### Among-dam component `\(\sigma_d^2\)`

`\begin{align*}
\sigma_d^2 &amp;  = \sigma_P^2 - \sigma_s^2 - \sigma_w^2 \\
&amp; = \sigma^2_A + \sigma^2_D + \sigma^2_E - \frac{1}{4}\sigma_A^2 - (\frac{1}{2}\sigma^2_A + \frac{3}{4}\sigma^2_D + \sigma^2_E) \\
&amp; = \frac{1}{4}\sigma^2_A + \frac{1}{4}\sigma^2_D
\end{align*}`

--

Alternatively,

`\begin{align*}
\sigma_w^2 &amp;  = V_p - Cov(FS) \\
\sigma_s^2 &amp; = Cov(HS) \\
\sigma_d^2 &amp; = \sigma_P^2 - \sigma_s^2 - \sigma_w^2 \\
&amp; = V_p - Cov(HS) - V_p + Cov(FS) \\
&amp; = Cov(FS) - Cov(HS)
\end{align*}`


---

# Summary of the variance components

&lt;div align="center"&gt;
&lt;img src="sdkids.png" height=200&gt;
&lt;/div&gt;

| Observational  | Covariance and causal components  |  Estimated values  |
| :------------: | :-------: | :----:  | 
| Sires | `\(\sigma_s^2 = Cov(HS)\)`  | ?    |
| Dams  | `\(\sigma_d^2 = Cov(FS) - Cov(HS)\)` | ? | 
| Progeny | `\(\sigma_w^2 = V_P - Cov(FS)\)`  | ? |
| Total | `\(\sigma_T^2 = V_P = \sigma_s^2 + \sigma_d^2 + \sigma_w^2\)` | ? |
| Sires + Dams   | `\(\sigma_s^2 + \sigma_d^2 = Cov(FS)\)`       | ? |

---

# Summary of the variance components

| Observational  | Covariance and causal components  |  Estimated values  |
| :------------: | :-------: |  | 
| Sires | `\(\sigma_s^2 = Cov(HS)\)`  | `\(=\frac{1}{4}\sigma_A^2\)`    |
| Dams  | `\(\sigma_d^2 = Cov(FS) - Cov(HS)\)` | `\(=\frac{1}{4}\sigma_A^2 + \frac{1}{4}\sigma_D^2\)` | 
| Progeny | `\(\sigma_w^2 = V_P - Cov(FS)\)`  | `\(= \frac{1}{2}\sigma_A^2 +\frac{3}{4}\sigma_D^2\)` |
| Total | `\(\sigma_T^2 = V_P = \sigma_s^2 + \sigma_d^2 + \sigma_w^2\)` | `\(=\sigma_A^2 + \sigma_D^2 + \sigma_E^2\)` |
| Sires + Dams   | `\(\sigma_s^2 + \sigma_d^2 = Cov(FS)\)`       | `\(=\frac{1}{2}\sigma_A^2 + \frac{1}{4}\sigma_D^2\)` |

--

#### Variance componenets in a sib design

| Source        |    df     |  E(MS) | Estimated values |
| :------:      | :----------: | :--------------------:| :------: |
| Sires         | s-1       | `\(\sigma_w^2 + n\sigma_d^2 + dn\sigma_s^2\)`   | `\(= \frac{1}{2}\sigma_A^2 +\frac{3}{4}\sigma_D^2 + \frac{n}{4}\sigma_A^2 + \frac{n}{4}\sigma_D^2 + \frac{dn}{4}\sigma_A^2\)` |
| Dams (Sires)  | s(d-1)    | `\(\sigma_w^2 + n\sigma_d^2\)` | `\(= \frac{1}{2}\sigma_A^2 +\frac{3}{4}\sigma_D^2 + \frac{n}{4}\sigma_A^2 + \frac{n}{4}\sigma_D^2\)` |
| Sibs (Dams)   | sd(n-1)   | `\(\sigma_w^2\)` | `\(= \frac{1}{2}\sigma_A^2 +\frac{3}{4}\sigma_D^2\)` |




---
# Example: a sib experiment

- A balanced experimental data collected from 100 sires each mated to 4 dams.
- Have body length records of 5 male and 5 female offspring from each dam.
- Get `\(h^2\)` for body length?

--

### __ANOVA__ table for body length:

| Source         |    Mean Sq    | Value  |
| :------------: | :-----------: | :-------: | 
| Between Sires  |    `\(MS_s\)`      | =7.83      | 
| Between Dams   |    `\(MS_d\)`     | =4.51     |
| Within progenies |  `\(MS_w\)`    | =1.27    | 


---
# A sib experiment

#### __ANOVA__ table for body length:

| Source         |  Value    |    Mean Sq    |  Expectation of MS |
| :------------: | :-------: | :-------:     | :-------: |
| Between Sires  | 7.83      |    `\(MS_s\)`     | `\(= \sigma_w^2 + n\sigma_d^2 + dn\sigma_s^2\)` |
| Between Dams   | 4.51      |    `\(MS_d\)`     | `\(= \sigma_w^2 + n\sigma_d^2\)` | 
| Within progenies | 1.27    |    `\(MS_w\)`     | `\(= \sigma_w^2\)` |

--

First get `\(V_P\)`:  
`\begin{align*}
&amp; \sigma_w^2 = MS_w = 1.27 \\
&amp; \sigma_d^2 = (MS_d - \sigma_w^2)/n = (4.51-1.27)/10 = 0.324 \\
&amp; \sigma_s^2 = (MS_s - MS_d)/(dn) = (7.83-4.51)/(4 \times 10) = 0.083 \\
&amp; \sigma^2_P = \sigma_d^2 + \sigma_s^2 + \sigma_w^2 = 1.27 + 0.324 + 0.083 = 1.677 \\
\end{align*}`

--

Then get `\(V_A\)`:  
`\begin{align*}
&amp; \sigma^2_s = \sigma_A^2/4\\
&amp; \sigma_A^2 = 0.083 \times 4 = 0.332 \\
\end{align*}`


---
# A sib experiment

#### __ANOVA__ table for body length:

| Source         |  Value    |    Mean Sq    |  Expectation of MS |
| :------------: | :-------: | :-------:     | :-------: |
| Between Sires  | 7.83      |    `\(MS_s\)`     | `\(= \sigma_w^2 + n\sigma_d^2 + dn\sigma_s^2\)` |
| Between Dams   | 4.51      |    `\(MS_d\)`     | `\(= \sigma_w^2 + n\sigma_d^2\)` | 
| Within progenies | 1.27    |    `\(MS_w\)`     | `\(= \sigma_w^2\)` |


First get `\(V_P\)`:  
`\begin{align*}
&amp; \sigma^2_P = \sigma_d^2 + \sigma_s^2 + \sigma_w^2 = 1.27 + 0.324 + 0.083 = 1.677 \\
\end{align*}`


Then get `\(V_A\)`:  
`\begin{align*}
&amp; \sigma_A^2 = 0.083 \times 4 = 0.332 \\
\end{align*}`

--
Finally `\(h^2\)`
`\begin{align*}
&amp; h^2 =  \frac{\sigma^2_A}{\sigma^2_P} =  0.332/1.677 = 0.198\\
\end{align*}`

---

# Precision and design

### Data collection must be practical

- time/cost/etc is usually the important determinant
 
--

### Be freedom from bias
  - Random mating
  - Absence of common environmental effects, e.g. maternal effects.


---

# Precision and design

If we want to design a balanced experiment:
- `\(s\)` sires each mated to `\(d\)` dams
- Each dam has `\(n\)` progenies.

&lt;div align="center"&gt;
&lt;img src="sdkids.png" height=200&gt;
&lt;/div&gt;

--

#### Questions before experimental design?

1. Parent-offspring, half-sib, full-sib, or others?
1. How many families?
2. Numbers of progeny?
3. What if it is unbalanced?

---

# Sampling variance of `\(b\)`

F &amp; M page 178, the sampling variance of the parent-offspring regression ( `\(b\)` ) is approximately:

`\begin{align*}
SV_b = \frac{k[1+(n-1)t]}{nN}
\end{align*}`

- `\(N\)` families (offspring and parents)
- `\(k\)` parents (1 or 2) for each family
- `\(n\)` offspring per family
- `\(t\)` the intra-class correlation between offspring in a family

--

### One parent

Sampling variance is minimal when `\(n=1\)`, i.e. `\((n-1)t=0\)`.

--

The most efficient design:
1. as many families as possible
2. measure only one offspring per family

---

# One parent

`\begin{align*}
&amp; SV(h^2=2b) = 4/N \\
&amp; s.e.(h^2) = 2/\sqrt{N} \\
\end{align*}`

--


```r
N=1:1000
se &lt;- 2/sqrt(N)

plot(N, se, type="l", lwd=5, col="red")
```

&lt;img src="w11_c2_files/figure-html/unnamed-chunk-1-1.png" width="45%" style="display: block; margin: auto;" /&gt;






    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
